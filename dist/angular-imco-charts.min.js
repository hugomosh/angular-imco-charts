"use strict";angular.module("imco.charts",[]).directive("imcoLineChart",["$window",function(a){return{restrict:"EAC",scope:{config:"=?",chartData:"="},template:"<svg></svg>",link:function(b,c,d,e){var f=a.d3,g=c.find("svg")[0],h=function(a){var d=b.chartData.data,e={yDomain:[f.min(d,function(a){return Number(a.y)}),f.max(d,function(a){return Number(a.y)})],dataFormat:",.2f"};b.config||(b.config=e);var h={top:20,right:20,bottom:30,left:40},i=c.width()-h.left-h.right,j=c.height()-h.top-h.bottom,k=b.config.dataFormat?b.config.dataFormat:e.dataFormat,l=f.format(k),m=f.scale.ordinal().domain(d.map(function(a){return a.x})).rangePoints([0,i]),n=f.scale.linear().range([j,0]).domain(b.config.yDomain?b.config.yDomain:e.yDomain),o=f.svg.axis().scale(m).orient("bottom"),p=f.svg.axis().scale(n).orient("left"),q=f.svg.line().defined(function(a){return null!=Number(a.y)}).x(function(a){return m(a.x)}).y(function(a){return n(Number(a.y))}),r=Math.min(c.width(),c.height());r&&0!==r||(r=100);var s=f.select(g).style("width","100%").style("height","100%").attr("viewBox","0, 0, "+r+", "+r).attr("preserveAspectRatio","xMinYMin").datum(d).attr("width",i+h.left+h.right).attr("height",j+h.top+h.bottom).append("g").attr("transform","translate("+h.left+","+h.top+")");s.append("g").attr("class","x axis").attr("transform","translate(0,"+j+")").call(o),s.append("g").attr("class","y axis").attr("transform","translate(-5,0)").call(p),s.append("path").attr("class","line").attr("d",q),s.selectAll(".dot").data(d.filter(function(a){return Number(a.y)})).enter().append("circle").attr("class","dot").attr("cx",q.x()).attr("cy",q.y()).attr("r",3),s.selectAll(".text").data(d.filter(function(a){return Number(a.y)})).enter().append("text").text(function(a){return l(a.y)}).attr("x",q.x()).attr("y",q.y()).attr("font-family","sans-serif").attr("font-size","12px").attr("background-color","white").attr("transform","translate(-20,-10)").attr("fill","#2E9FA3")};b.$watch("chartData",function(a,b){a&&""!==a&&h()})}}}]).directive("imcoBarChart",["$window",function(a){return{restrict:"EAC",scope:{charConfig:"=?",chartData:"=",barClickFunction:"&?"},template:'<svg class="bar-chart"></svg>',link:function(b,c,d,e){function f(){var a={top:20,right:0,bottom:10,left:0},d=c.width(),e=c.height()-a.top-a.bottom,f=p.format(".0%"),f=p.format(b.config.format||h.format),h={yAxis:{visible:!1,text:"Frequency",format:".0%"}},q=c.find("svg")[0];j=p.scale.ordinal().rangeRoundBands([b.config.yAxis.space+10,d],.1,0),k=p.scale.linear().range([e,0]),m=p.svg.axis().scale(j).orient("bottom");var r=p.svg.axis().scale(k).orient("left").tickFormat(f);i=p.select(q);var s=Math.min(c.width(),c.height());s&&0!==s||(s=100),i.attr("width",d+2*a.left+a.right).attr("height",e+a.top+a.bottom).append("g").attr("transform","translate("+a.left+","+a.top+")"),n=p.tip().attr("class","d3-tip").offset([-10,0]).html(function(a){return a.tooltip}),i.call(n),l=b.chartData,l.forEach(function(a){a.frequency=+a.frequency}),j.domain(l.map(function(a){return a.letter})),k.domain([0,p.max(l,function(a){return a.frequency})]),i.append("g").attr("class","x axis").attr("transform","translate(0,"+e+")").call(m);var t=i.append("g").attr("class","y axis").call(r).attr("transform","translate("+b.config.yAxis.space+",0)");b.config.yAxis.visible&&t.append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy",".71em").style("text-anchor","end").text(b.config.yAxis.text),i.selectAll(".bar").data(l).enter().append("rect").attr("class",function(a){return(a.selected?"active":"")+" bar "}).attr("x",function(a){return j(a.letter)}).attr("width",j.rangeBand()).attr("y",function(a){return k(a.frequency)}).attr("height",function(a){return e-k(a.frequency)}).on("mouseover",n.show).on("mouseout",n.hide).on("click",function(a){b.barClickFunction&&b.barClickFunction({ent:a.entidad})}),p.select("input").on("change",g),o=setTimeout(function(){p.select("input").property("checked",!0).each(g)},2e3)}function g(){clearTimeout(o);var a=j.domain(l.sort(this.checked?function(a,b){return b.frequency-a.frequency}:function(a,b){return p.ascending(a.letter,b.letter)}).map(function(a){return a.letter})).copy();i.selectAll(".bar").sort(function(b,c){return a(b.letter)-a(c.letter)});var b=i.transition().duration(750),c=function(a,b){return 50*b};b.selectAll(".bar").delay(c).attr("x",function(b){return a(b.letter)}),b.select(".x.axis").call(m).selectAll("g").delay(c)}function h(a){l=a;var b=j.domain(l.sort(p.select("input").property("checked")?function(a,b){return b.frequency-a.frequency}:function(a,b){return p.ascending(a.letter,b.letter)}).map(function(a){return a.letter})).copy();i.selectAll(".bar").sort(function(a,c){return b(a.letter)-b(c.letter)}),i.selectAll(".bar").data(l).classed("active",function(a){return a.selected})}var i,j,k,l,m,n,o,p=a.d3,q={yAxis:{visible:!1,text:"Y",space:35},format:"g"};b.charConfig?b.config=b.charConfig:b.config=q,b.chartData&&f(),b.$watch("chartData",function(a,b){a&&""!==a&&h(a)})}}}]).directive("imcoArcChart",["$window",function(a){var b=2*Math.PI,c=function(c,d,e){function f(a,b){a.attrTween("d",function(a){var c=g.interpolate(a.endAngle,b);return function(b){return a.endAngle=c(b),q(a)}})}c.value||(c.value=50),c.total&&0!==c.total||(c.total=100),c.percentage=c.value/c.total,c.color?c.colorfun=function(){return String(c.color).replace("'","")}:c.colorfun||(c.colorfun=function(a){return"orange"});var g=a.d3,h=d.find("svg")[0],i=g.select(h),j=Math.min(d.width(),d.height());j&&0!==j||(j=100),i.style("width","100%").style("height","100%").attr("viewBox","0, 0, "+j+", "+j).attr("preserveAspectRatio","xMinYMin");var k,l,m=.05,n=j*m,o=Math.ceil(.3*n),p=j/2-o,q=g.svg.arc().innerRadius(p-n).outerRadius(p).startAngle(0),r=function(){i.select("g").remove();var a=i.append("g").attr("transform","translate("+j/2+","+j/2+")"),d=g.svg.arc().startAngle(0).endAngle(b).innerRadius(p+o-n).outerRadius(p-o),e=g.svg.arc().startAngle(0).endAngle(b).innerRadius(p-n).outerRadius(p);if(a.append("path").attr("d",d).attr("fill",function(){return"#eee"}),k=a.append("path").datum({endAngle:0}).attr("d",e).attr("fill",function(){return c.colorfun(c.percentage)}),k.transition().duration(2e3).call(f,c.percentage*b),c.text){var h=h=p/2;l=a.append("text").text(c.text).attr("text-anchor","middle").attr("dx",2).attr("style","font-size : "+h+"px"),l.attr("dy",h/3)}};r(),c.$watch("value",function(a,b){a&&r()})};return{restrict:"EAC",scope:{value:"=?",total:"=",text:"=?",colorfun:"=?",color:"@"},template:'<svg class="donout-chart-svg"></svg>',link:c}}]);